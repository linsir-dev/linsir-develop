# 类加载的生命周期

类加载的生命周期是Java虚拟机（JVM）中类从被加载到被卸载的完整过程，主要包括以下五个阶段：

## 1. 加载（Loading）
- **目的**：将类的字节码文件加载到内存中
- **具体操作**：
  - 通过类的全限定名（包名+类名）获取类的二进制字节流
  - 将字节流所代表的静态存储结构转换为方法区的运行时数据结构
  - 在内存中生成一个代表该类的`java.lang.Class`对象，作为方法区中该类各种数据的访问入口

## 2. 链接（Linking）
链接阶段分为三个子阶段：

### 2.1 验证（Verification）
- **目的**：确保类的字节码文件符合JVM规范，保证安全
- **具体操作**：
  - 文件格式验证：验证字节流是否符合Class文件格式规范
  - 元数据验证：验证类的元数据信息是否符合JVM规范
  - 字节码验证：验证字节码指令的语义是否合法
  - 符号引用验证：验证符号引用是否能够正确解析

### 2.2 准备（Preparation）
- **目的**：为类的静态变量分配内存并设置初始值
- **具体操作**：
  - 为静态变量分配内存空间（在方法区中）
  - 设置静态变量的初始值（零值），例如：
    - `int`类型初始值为0
    - `boolean`类型初始值为false
    - 引用类型初始值为null

### 2.3 解析（Resolution）
- **目的**：将符号引用转换为直接引用
- **具体操作**：
  - 符号引用：以一组符号来描述所引用的目标，如类名、方法名等
  - 直接引用：直接指向目标的内存地址或句柄
  - 解析主要针对类、接口、字段、方法等的符号引用

## 3. 初始化（Initialization）
- **目的**：执行类的初始化代码，为静态变量赋予正确的初始值
- **具体操作**：
  - 执行静态代码块（`<clinit>()`方法）
  - 为静态变量赋予代码中指定的初始值
  - 初始化顺序：父类优先于子类，静态变量和静态代码块按代码顺序执行

## 4. 使用（Using）
- **目的**：类的实例化和方法调用
- **具体操作**：
  - 创建类的实例（通过`new`关键字或反射等方式）
  - 调用类的方法（静态方法或实例方法）
  - 访问类的静态变量和实例变量

## 5. 卸载（Unloading）
- **目的**：将类从内存中移除
- **具体操作**：
  - 类的所有实例都已被垃圾回收
  - 加载该类的ClassLoader已被垃圾回收
  - 该类对应的`java.lang.Class`对象没有任何引用
  - 满足以上条件时，JVM会在适当的时候卸载该类

## 注意事项
- 类加载的生命周期是一个严格的顺序过程，必须按照加载→链接→初始化→使用→卸载的顺序进行
- 链接阶段的验证、准备、解析三个子阶段可能会交叉进行
- 初始化阶段是类加载过程中的核心阶段，只有在必要时才会触发（按需初始化）
- 并非所有类都会经历卸载阶段，有些类（如系统类）可能会一直存在于内存中直到JVM退出