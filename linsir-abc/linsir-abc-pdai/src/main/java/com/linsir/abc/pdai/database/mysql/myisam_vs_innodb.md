# MyISAM 和 InnoDB 的区别

## 1. 存储引擎概述

**MyISAM** 和 **InnoDB** 是 MySQL 中最常用的两种存储引擎，它们在设计理念、功能特性和适用场景上有显著差异。

## 2. 核心区别

### 2.1 事务支持

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 事务支持 | ❌ 不支持 | ✅ 支持（ACID 特性） |
| 回滚能力 | ❌ 无 | ✅ 有 |
| 崩溃恢复 | ❌ 不可靠 | ✅ 可靠 |

### 2.2 锁机制

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 锁粒度 | 表级锁 | 行级锁（默认），支持表级锁 |
| 并发性能 | 低（写操作阻塞所有读操作） | 高（支持读写并发） |
| 死锁检测 | ❌ 无 | ✅ 有 |

### 2.3 存储结构

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 数据存储 | 分离的文件（.MYD 数据文件，.MYI 索引文件） | 聚集索引（数据和索引存储在一起） |
| 表空间 | 每个表独立 | 支持共享表空间和独立表空间 |
| 外键支持 | ❌ 不支持 | ✅ 支持 |

### 2.4 索引实现

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 索引类型 | B-Tree 索引 | B+Tree 索引 |
| 聚集索引 | ❌ 无 | ✅ 有（主键索引即为聚集索引） |
| 全文索引 | ✅ 支持 | ✅ 支持（5.6+） |
| 空间索引 | ✅ 支持 | ✅ 支持 |

### 2.5 性能特点

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 读性能 | 高 | 较高 |
| 写性能 | 低 | 高 |
| 内存使用 | 低 | 高（需要缓冲池） |
| 表大小限制 | 较大（受操作系统文件大小限制） | 较大（64TB） |

### 2.6 适用场景

| 存储引擎 | 适用场景 | 不适用场景 |
|---------|---------|----------|
| MyISAM | - 只读或读多写少的应用<br>- 简单的 Web 应用<br>- 数据仓库 | - 高并发应用<br>- 事务要求高的应用<br>- 可靠性要求高的应用 |
| InnoDB | - 高并发应用<br>- 事务要求高的应用<br>- 可靠性要求高的应用<br>- 数据一致性要求高的应用 | - 只读或读多写少且对性能要求极高的应用 |

## 3. 技术实现细节

### 3.1 MyISAM 实现

- **存储文件**：
  - `.frm`：表结构文件
  - `.MYD`：数据文件
  - `.MYI`：索引文件

- **索引结构**：
  - 非聚集索引，索引和数据分离
  - 索引叶子节点存储数据的物理地址

- **并发控制**：
  - 表级锁
  - 写锁优先级高于读锁
  - 不支持事务，崩溃后可能导致数据损坏

### 3.2 InnoDB 实现

- **存储文件**：
  - `.frm`：表结构文件（MySQL 8.0 后改为 `.ibd`）
  - `.ibd`：数据和索引文件（独立表空间）
  - `ibdata1`：共享表空间文件

- **索引结构**：
  - 聚集索引：主键索引叶子节点存储数据行
  - 辅助索引：叶子节点存储主键值
  - 支持自适应哈希索引

- **并发控制**：
  - 行级锁
  - 支持多版本并发控制（MVCC）
  - 支持事务，崩溃后可通过重做日志恢复

## 4. 性能优化建议

### 4.1 MyISAM 优化

- 适合读多写少的场景
- 启用键缓冲（key_buffer_size）
- 定期执行 OPTIMIZE TABLE 操作
- 避免长事务

### 4.2 InnoDB 优化

- 合理设置缓冲池大小（innodb_buffer_pool_size）
- 使用自增主键
- 合理设计索引
- 避免全表扫描
- 合理设置事务隔离级别
- 启用 innodb_file_per_table

## 5. 如何选择存储引擎

### 5.1 选择 MyISAM 的情况

1. **只读应用**：如静态网站
2. **读多写少**：如内容管理系统
3. **对事务无要求**：如简单的日志系统
4. **需要全文索引**：在旧版本 MySQL 中

### 5.2 选择 InnoDB 的情况

1. **高并发应用**：如电商网站
2. **事务要求高**：如金融系统
3. **数据一致性要求高**：如订单系统
4. **需要外键约束**：如关系复杂的系统
5. **可靠性要求高**：如核心业务系统

## 6. 迁移存储引擎

### 6.1 MyISAM 迁移到 InnoDB

```sql
-- 方法1：修改表结构
ALTER TABLE table_name ENGINE=InnoDB;

-- 方法2：导出导入
mysqldump -u user -p database table_name > table.sql
mysql -u user -p database < table.sql
```

### 6.2 InnoDB 迁移到 MyISAM

```sql
-- 修改表结构
ALTER TABLE table_name ENGINE=MyISAM;
```

## 7. 总结

| 特性 | MyISAM | InnoDB |
|------|--------|--------|
| 事务 | ❌ | ✅ |
| 锁粒度 | 表级 | 行级 |
| 外键 | ❌ | ✅ |
| 聚集索引 | ❌ | ✅ |
| 崩溃恢复 | ❌ | ✅ |
| 并发性能 | 低 | 高 |
| 适用场景 | 读多写少 | 高并发事务 |

**注意**：自 MySQL 5.5 起，InnoDB 成为默认存储引擎，适用于大多数应用场景。对于特殊需求，可根据具体情况选择合适的存储引擎。